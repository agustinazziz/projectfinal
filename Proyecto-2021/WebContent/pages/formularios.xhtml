<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition template="/layout/layout.xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">
	
	
	<ui:define name="title">
		<c:set var="title" value="Gestion de Formularios" scope="request" />
	</ui:define>
	
	<ui:define name="content">
	
		<h:form>
		

		
		<h:commandButton value="Buscar"	action="#{gestionFormularios.seleccionarFormularios}" />
				
	</h:form>

	<h3><h:outputLabel value="Formularios seleccionados"/></h3>
	<p:dataTable editable="true" id = "formulariosTable" value="#{gestionFormularios.formsEncontrados}" var="forms" tableStyle="width:auto" styleClass = "employeeTable" headerClass = "employeeTableHeader">
   		   
   		   	<p:column  sortBy="#{forms.id}">
			<f:facet name="header">ID</f:facet>    				
      		#{forms.id}
   		</p:column>
   		
   		<p:column sortBy="#{forms.nombre}">
			<f:facet name="header">Nombre</f:facet>
                <h:outputText style="min-width:80px;white-space: normal !important;" value="#{forms.nombre}"/>
		</p:column>
		
   		<p:column editable="true" sortBy="#{forms.resumen}">
				<f:facet name="header">Resumen</f:facet>    				
                <h:outputText style="min-width:80px;white-space: normal !important;" value="#{forms.resumen}"/>
   		</p:column>
   		
   		<p:column>
			   		<f:facet name="header"> Casillas Extra </f:facet>
			   									
			   									
   			<p:dataTable tableStyle="width:auto" value="#{forms.casillaNueva}" var="casilla" >
				
				
						<p:column > 
							<f:facet name="header">Nombre</f:facet> 
						
								 #{casilla.nombre}	<br></br>	
							
						</p:column>
						
						<p:column> 
							<f:facet name="header">Descripción</f:facet> 	
						</p:column>
						
						<p:column> 
							<f:facet name="header">Parametro</f:facet> 	
								#{casilla.parametro}		
						</p:column>
						
						<p:column> 
							<f:facet name="header">Tipo de dato</f:facet> 	
								#{casilla.tiposDato}		
						</p:column>
						
						<p:column> 
							<f:facet name="header">Unidad de medida</f:facet> 	
								#{casilla.unidadesMedida}		
						</p:column>
						
					
			</p:dataTable>
   		</p:column>
		
		<p:column> 
			<f:facet name="header">Actividad</f:facet> 
			<h:form>
				
			<h:commandLink  value="Crear" action="#{gestionActividad.modifContador()}" update=":form">
				<f:param name="contador" value="#{forms.casillaNueva.size()}" />
				<f:param name="nomForm" value="#{forms.nombre}" />
				<f:param name="resumenForm" value="#{forms.resumen}" />
				<f:param name="idForm" value="#{forms.id}" />
				<c:forEach varStatus="row" var="cas" begin="0" end="#{forms.casillaNueva.size()+2}">
					<f:param name="casId-${cas}" value="#{forms.casillaNueva[row.index].idCasilla}"/>
					<f:param name="casNom-${cas}" value="#{forms.casillaNueva[row.index].nombre}"/>
					<f:param name="casDesc-${cas}" value="#{forms.casillaNueva[row.index].descripcion}"/>
					<f:param name="casParam-${cas}" value="#{forms.casillaNueva[row.index].parametro}"/>
					<f:param name="casTipo-${cas}" value="#{forms.casillaNueva[row.index].tiposDato}"/>
					<f:param name="casUni-${cas}" value="#{forms.casillaNueva[row.index].unidadesMedida}"/>
				</c:forEach>
			</h:commandLink>
			
			<br></br><br></br>
			<h:link value="Ver" outcome="DatosUsuario.xhtml" />
			</h:form>
		</p:column>
		

		<p:column rendered="#{gestionUsuarios.rolExperto()}">
			<h:form>
		   		<h:commandLink onclick="if (! confirm('Está seguro de borrar el formulario?')) return false"
				value="Borrar Formulario" action="#{gestionFormularios.borrarForm()}" update=":form" class="edit_icon" >

					<f:param name="idFormDel" value="#{forms.id}" />

				</h:commandLink> 
			</h:form>
		</p:column>
		
		<p:column>
			<h:form>
				<h:commandLink  value="Editar formulario" action="/pages/modifForm.xhtml" update=":form">
				</h:commandLink>			
			</h:form>
		</p:column>

	</p:dataTable>

    
    </ui:define>
</ui:composition>
